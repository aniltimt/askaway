.row
  .col-xs-12.col-md-8.col-md-offset-2
    - avatar_selection_choices = @user.avatar_selection_choices
    - if avatar_selection_choices.count > 1
      .panel.panel-default
        .panel-heading
          %h1.panel-title Choose a profile picture
        .panel-body
          %ul.list-group
            - avatar_selection_choices.each do |choice|
              -# TODO: refactor into AvatarChoice object
              %li.list-group-item
                %div.media
                  %span.pull-left
                    - choice_sliced = choice.slice(:type, :identity).merge(size: :small)
                    - choice_url = select_avatar_users_path(choice_sliced)
                    = link_to choice_url, method: :patch do
                      = image_tag current_user.specific_avatar_url(choice_sliced), class: 'media-object avatar avatar-choice-icon'
                  .media-body.avatar-choice-text
                    - if choice[:selected]
                      #{choice[:name].capitalize} picture
                      %span.gray-light.thin= '(selected)'
                    - elsif choice[:type] == 'identity' || choice[:type] == 'uploaded_avatar'
                      = link_to "Use your #{choice[:name]} picture", choice_url, method: :patch
                    - elsif choice[:type] == 'placeholder'
                      = link_to "Use a random animal picture", choice_url, class: 'avatar-choice-link', method: :patch
            - if UserPolicy.new(current_user, current_user).upload_avatar?
              %li.list-group-item
                %div.media.comment.answer
                  %span.pull-left
                    %span.fa.fa-plus.avatar-upload-icon
                  .media-body.avatar-choice-text
                    = link_to "Upload your own", new_avatar_users_path

    .panel.panel-default
      .panel-heading
        %h1.panel-title Edit your details
      .panel-body
        = render 'form'

/ #upload-avatar-modal.modal.fade
/   .modal-dialog
/     .modal-content
/       .modal-header
/         %button.close{:type => 'button', 'data-dismiss' => 'modal'}
/           x
/         %h4.modal-title Upload a profile picture
/       .modal-body
